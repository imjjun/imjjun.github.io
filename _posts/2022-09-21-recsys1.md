---
title: Introduction to Recommend System (1) Content-based Filtering
tags: RecSys
---


안녕하세요, Imjjun입니다!

첫 포스팅으로 제가 현재 프로젝트 공부하고 있는 추천시스템을 가져와봤는데요, 어떻게보면 비지도학습의 끝판왕(...)이라 할 수 있을만큼 주제 자체가 꽤나 어려운데요.

저도 Rec Sys를 처음 공부하는지라... 입문자용으로 공부해보려고 데이콘에서 [데이문 4편] 추천 시스템 사용 설명서 올려주신 것으로 공부해봤네요. 해당 사이트 링크는 하기와 같습니다.
https://dacon.io/competitions/official/235946/codeshare/6046?page=1&dtype=random


여튼 같이 손코딩 및 md 작성해보면서 추천 시스템에 대해서 구체적으로 알아보는 시간 가져볼게요 !

###1) 추천 시스템의 정의

추천 시스템이란 사용자의 취향을 이해하고 맞춤 상품과 콘텐츠를 이용하여 추천해주는 시스템을 의미합니다.
우리가 자주 사용하는 유튜브나 넷플릭스, 티빙 등의 OTT 플랫폼은 물론 쿠팡, SSG 등 유통 업체에서도 고객 데이터를 기반으로 추천 시스템을 구축하고 있습니다.

###2) 추천 시스템의 유형


1. 콘텐츠 기반 필터링(Content based filtering)

2. 협업 필터링(Collaborative filtering)

    2-1. 최근접 이웃 협업 필터링(Nearest Neighbor Collaborative filtering)

    2-2. 잠재 요인 협업 필터링(Latent factor Collaborative filtering)



###1. 콘텐츠 기반 필터링(Content based filitering)

콘텐츠 기반 필터링 방식은 사용자가 특정한 아이템을 매우 선호하는 경우, 그 아이템과 비슷한 콘텐츠를 가진 다른 아이템을 추천하는 방식입니다.
사용자가 특정 영화에 높은 평점을 줬다면 그 영화의 장르, 출연 배우, 감독, 영화 키워드 등의 콘텐츠와 유사한 다른 영화를 추천해주는 것이죠.


```python
#Library import

import pandas as pd
import numpy as np
import warnings;warnings.filterwarnings('ignore')
```


```python
#Data Arrangement

from google.colab import drive
drive.mount('/content/drive')
```

    Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount("/content/drive", force_remount=True).



```python
movies=pd.read_csv('/content/drive/MyDrive/tmdb_5000_movies.csv')
movies.head()
```





  <div id="df-e4fa975d-327b-49da-ba74-cdd8d8cd751a">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>budget</th>
      <th>genres</th>
      <th>homepage</th>
      <th>id</th>
      <th>keywords</th>
      <th>original_language</th>
      <th>original_title</th>
      <th>overview</th>
      <th>popularity</th>
      <th>production_companies</th>
      <th>production_countries</th>
      <th>release_date</th>
      <th>revenue</th>
      <th>runtime</th>
      <th>spoken_languages</th>
      <th>status</th>
      <th>tagline</th>
      <th>title</th>
      <th>vote_average</th>
      <th>vote_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>237000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "name": "Adventure"}, {"id": 14, "name": "Fantasy"}, {...</td>
      <td>http://www.avatarmovie.com/</td>
      <td>19995</td>
      <td>[{"id": 1463, "name": "culture clash"}, {"id": 2964, "name": "future"}, {"id": 3386, "name": "sp...</td>
      <td>en</td>
      <td>Avatar</td>
      <td>In the 22nd century, a paraplegic Marine is dispatched to the moon Pandora on a unique mission, ...</td>
      <td>150.437577</td>
      <td>[{"name": "Ingenious Film Partners", "id": 289}, {"name": "Twentieth Century Fox Film Corporatio...</td>
      <td>[{"iso_3166_1": "US", "name": "United States of America"}, {"iso_3166_1": "GB", "name": "United ...</td>
      <td>2009-12-10</td>
      <td>2787965087</td>
      <td>162.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}, {"iso_639_1": "es", "name": "Espa\u00f1ol"}]</td>
      <td>Released</td>
      <td>Enter the World of Pandora.</td>
      <td>Avatar</td>
      <td>7.2</td>
      <td>11800</td>
    </tr>
    <tr>
      <th>1</th>
      <td>300000000</td>
      <td>[{"id": 12, "name": "Adventure"}, {"id": 14, "name": "Fantasy"}, {"id": 28, "name": "Action"}]</td>
      <td>http://disney.go.com/disneypictures/pirates/</td>
      <td>285</td>
      <td>[{"id": 270, "name": "ocean"}, {"id": 726, "name": "drug abuse"}, {"id": 911, "name": "exotic is...</td>
      <td>en</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>Captain Barbossa, long believed to be dead, has come back to life and is headed to the edge of t...</td>
      <td>139.082615</td>
      <td>[{"name": "Walt Disney Pictures", "id": 2}, {"name": "Jerry Bruckheimer Films", "id": 130}, {"na...</td>
      <td>[{"iso_3166_1": "US", "name": "United States of America"}]</td>
      <td>2007-05-19</td>
      <td>961000000</td>
      <td>169.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}]</td>
      <td>Released</td>
      <td>At the end of the world, the adventure begins.</td>
      <td>Pirates of the Caribbean: At World's End</td>
      <td>6.9</td>
      <td>4500</td>
    </tr>
    <tr>
      <th>2</th>
      <td>245000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "name": "Adventure"}, {"id": 80, "name": "Crime"}]</td>
      <td>http://www.sonypictures.com/movies/spectre/</td>
      <td>206647</td>
      <td>[{"id": 470, "name": "spy"}, {"id": 818, "name": "based on novel"}, {"id": 4289, "name": "secret...</td>
      <td>en</td>
      <td>Spectre</td>
      <td>A cryptic message from Bond’s past sends him on a trail to uncover a sinister organization. Whil...</td>
      <td>107.376788</td>
      <td>[{"name": "Columbia Pictures", "id": 5}, {"name": "Danjaq", "id": 10761}, {"name": "B24", "id": ...</td>
      <td>[{"iso_3166_1": "GB", "name": "United Kingdom"}, {"iso_3166_1": "US", "name": "United States of ...</td>
      <td>2015-10-26</td>
      <td>880674609</td>
      <td>148.0</td>
      <td>[{"iso_639_1": "fr", "name": "Fran\u00e7ais"}, {"iso_639_1": "en", "name": "English"}, {"iso_639...</td>
      <td>Released</td>
      <td>A Plan No One Escapes</td>
      <td>Spectre</td>
      <td>6.3</td>
      <td>4466</td>
    </tr>
    <tr>
      <th>3</th>
      <td>250000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 80, "name": "Crime"}, {"id": 18, "name": "Drama"}, {"id": ...</td>
      <td>http://www.thedarkknightrises.com/</td>
      <td>49026</td>
      <td>[{"id": 849, "name": "dc comics"}, {"id": 853, "name": "crime fighter"}, {"id": 949, "name": "te...</td>
      <td>en</td>
      <td>The Dark Knight Rises</td>
      <td>Following the death of District Attorney Harvey Dent, Batman assumes responsibility for Dent's c...</td>
      <td>112.312950</td>
      <td>[{"name": "Legendary Pictures", "id": 923}, {"name": "Warner Bros.", "id": 6194}, {"name": "DC E...</td>
      <td>[{"iso_3166_1": "US", "name": "United States of America"}]</td>
      <td>2012-07-16</td>
      <td>1084939099</td>
      <td>165.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}]</td>
      <td>Released</td>
      <td>The Legend Ends</td>
      <td>The Dark Knight Rises</td>
      <td>7.6</td>
      <td>9106</td>
    </tr>
    <tr>
      <th>4</th>
      <td>260000000</td>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "name": "Adventure"}, {"id": 878, "name": "Science Fic...</td>
      <td>http://movies.disney.com/john-carter</td>
      <td>49529</td>
      <td>[{"id": 818, "name": "based on novel"}, {"id": 839, "name": "mars"}, {"id": 1456, "name": "medal...</td>
      <td>en</td>
      <td>John Carter</td>
      <td>John Carter is a war-weary, former military captain who's inexplicably transported to the myster...</td>
      <td>43.926995</td>
      <td>[{"name": "Walt Disney Pictures", "id": 2}]</td>
      <td>[{"iso_3166_1": "US", "name": "United States of America"}]</td>
      <td>2012-03-07</td>
      <td>284139100</td>
      <td>132.0</td>
      <td>[{"iso_639_1": "en", "name": "English"}]</td>
      <td>Released</td>
      <td>Lost in our world, found in another.</td>
      <td>John Carter</td>
      <td>6.1</td>
      <td>2124</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-e4fa975d-327b-49da-ba74-cdd8d8cd751a')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-e4fa975d-327b-49da-ba74-cdd8d8cd751a button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-e4fa975d-327b-49da-ba74-cdd8d8cd751a');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
print('Dataframe Shape: =', movies.shape, '\n')
print(movies.info())
```

    Dataframe Shape: = (4803, 20) 
    
    <class 'pandas.core.frame.DataFrame'>
    RangeIndex: 4803 entries, 0 to 4802
    Data columns (total 20 columns):
     #   Column                Non-Null Count  Dtype  
    ---  ------                --------------  -----  
     0   budget                4803 non-null   int64  
     1   genres                4803 non-null   object 
     2   homepage              1712 non-null   object 
     3   id                    4803 non-null   int64  
     4   keywords              4803 non-null   object 
     5   original_language     4803 non-null   object 
     6   original_title        4803 non-null   object 
     7   overview              4800 non-null   object 
     8   popularity            4803 non-null   float64
     9   production_companies  4803 non-null   object 
     10  production_countries  4803 non-null   object 
     11  release_date          4802 non-null   object 
     12  revenue               4803 non-null   int64  
     13  runtime               4801 non-null   float64
     14  spoken_languages      4803 non-null   object 
     15  status                4803 non-null   object 
     16  tagline               3959 non-null   object 
     17  title                 4803 non-null   object 
     18  vote_average          4803 non-null   float64
     19  vote_count            4803 non-null   int64  
    dtypes: float64(3), int64(4), object(13)
    memory usage: 750.6+ KB
    None



```python
#DataFrame with necessary information
movies_df=movies[['id','title', 'genres', 'vote_average', 'vote_count',
                 'popularity', 'keywords', 'overview']]
```


```python
#movie_df의 Genres와 Keywords를 뽑아서 첫 Row를 출력
pd.set_option('max_colwidth', 100)
movies_df[['genres','keywords']][:1]
```





  <div id="df-93a15590-d12a-44c4-88e4-648ca9d90267">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>genres</th>
      <th>keywords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[{"id": 28, "name": "Action"}, {"id": 12, "name": "Adventure"}, {"id": 14, "name": "Fantasy"}, {...</td>
      <td>[{"id": 1463, "name": "culture clash"}, {"id": 2964, "name": "future"}, {"id": 3386, "name": "sp...</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-93a15590-d12a-44c4-88e4-648ca9d90267')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-93a15590-d12a-44c4-88e4-648ca9d90267 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-93a15590-d12a-44c4-88e4-648ca9d90267');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
#Data Augmentation of dictionary
from ast import literal_eval

movies_df['genres'] = movies_df['genres'].apply(literal_eval)
movies_df['keywords'] = movies_df['keywords'].apply(literal_eval)


#literal_eval()함수를 이용하여 문자열을 객체로 변환
#Dictionary 내의 name Key 값에 해당하는 value를 객체로 변환
movies_df['genres'] = movies_df['genres'].apply(lambda x : [ y['name'] for y in x])
movies_df['keywords'] = movies_df['keywords'].apply(lambda x : [ y['name'] for y in x])
```


```python
movies_df[['genres', 'keywords']][:1]
```





  <div id="df-a81870ee-a2f6-41f5-a4f7-ce58fbc2f3a6">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>genres</th>
      <th>keywords</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[Action, Adventure, Fantasy, Science Fiction]</td>
      <td>[culture clash, future, space war, space colony, society, space travel, futuristic, romance, spa...</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-a81870ee-a2f6-41f5-a4f7-ce58fbc2f3a6')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-a81870ee-a2f6-41f5-a4f7-ce58fbc2f3a6 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-a81870ee-a2f6-41f5-a4f7-ce58fbc2f3a6');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
#1. CountVectorizer 벡터화

from sklearn.feature_extraction.text import CountVectorizer

# CountVectorizer를 적용하기 위해 공백문자로 word 단위가 구분되는 문자열로 변환. 
movies_df['genres_literal'] = movies_df['genres'].apply(lambda x : (' ').join(x))
count_vect = CountVectorizer(min_df=0, ngram_range=(1,2))
genre_mat = count_vect.fit_transform(movies_df['genres_literal'])
print(genre_mat.shape)
```

    (4803, 276)


4803개의 Record와 276개의 개별 단어 Feature로 구성된 벡터 행렬 생성


```python
#2. Cosine 유사도 비교

from sklearn.metrics.pairwise import cosine_similarity
#sci-kit learn의 cosine_similarity를 이용하면 코사인 유사도 계산 가능
genre_sim = cosine_similarity(genre_mat, genre_mat)
print(genre_sim.shape)
print(genre_sim[:2])
```

    (4803, 4803)
    [[1.         0.59628479 0.4472136  ... 0.         0.         0.        ]
     [0.59628479 1.         0.4        ... 0.         0.         0.        ]]



```python
#유사도가 높은 값들을 Sorting하여 유사도가 높은 ID 추출
genre_sim_sorted_ind = genre_sim.argsort()[:, ::-1]
print(genre_sim_sorted_ind[:1])
```

    [[   0 3494  813 ... 3038 3037 2401]]


Interpretation: 0번 레코드의 경우 3494번 ID와 2401번 ID와 유사도가 가장 높다고 할 수 있다. 

(3494번의 경우 -1 쪽에서 가장 유사하고, 2401번의 경우 1쪽에서 가장 유사한 경우에 해당)


```python
#3. 장르 유사도에 따른 영화 추천

def find_sim_movie(df, sorted_ind, title_name, top_n=10):
    
    # 인자로 입력된 movies_df DataFrame에서 'title' 컬럼이 입력된 title_name 값인 DataFrame추출
    title_movie = df[df['title'] == title_name]
    
    # title_named을 가진 DataFrame의 index 객체를 ndarray로 반환하고 
    # sorted_ind 인자로 입력된 genre_sim_sorted_ind 객체에서 유사도 순으로 top_n 개의 index 추출
    title_index = title_movie.index.values
    similar_indexes = sorted_ind[title_index, :(top_n)]
    
    # 추출된 top_n index들 출력. top_n index는 2차원 데이터. 
    # Dataframe에서 index로 사용하기 위해서 1차원 array로 변경
    print(similar_indexes)
    similar_indexes = similar_indexes.reshape(-1)
    
    return df.iloc[similar_indexes]

```


```python
#영화 <아바타(Avatar)>와 유사한 영화 10개를 추천한 결과
similar_movies = find_sim_movie(movies_df, genre_sim_sorted_ind, 'Avatar',10)
similar_movies[['title', 'vote_average']]
```

    [[   0 3494  813  870   46   14 1296 1652  419  420]]






  <div id="df-594326f7-22f8-4192-9ef5-78eb26e75ccb">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Avatar</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>3494</th>
      <td>Beastmaster 2: Through the Portal of Time</td>
      <td>4.6</td>
    </tr>
    <tr>
      <th>813</th>
      <td>Superman</td>
      <td>6.9</td>
    </tr>
    <tr>
      <th>870</th>
      <td>Superman II</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>46</th>
      <td>X-Men: Days of Future Past</td>
      <td>7.5</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Man of Steel</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>1296</th>
      <td>Superman III</td>
      <td>5.3</td>
    </tr>
    <tr>
      <th>1652</th>
      <td>Dragonball Evolution</td>
      <td>2.9</td>
    </tr>
    <tr>
      <th>419</th>
      <td>Jumper</td>
      <td>5.9</td>
    </tr>
    <tr>
      <th>420</th>
      <td>Hellboy II: The Golden Army</td>
      <td>6.5</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-594326f7-22f8-4192-9ef5-78eb26e75ccb')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-594326f7-22f8-4192-9ef5-78eb26e75ccb button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-594326f7-22f8-4192-9ef5-78eb26e75ccb');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
#평점 정보까지 적용한 상위 10개 영화 추출
movies_df[['title','vote_average','vote_count']].sort_values('vote_average', ascending=False)[:10]
```





  <div id="df-12fa32e9-8f85-4069-8466-5b6a5805aeeb">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
      <th>vote_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3519</th>
      <td>Stiff Upper Lips</td>
      <td>10.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4247</th>
      <td>Me You and Five Bucks</td>
      <td>10.0</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4045</th>
      <td>Dancer, Texas Pop. 81</td>
      <td>10.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4662</th>
      <td>Little Big Top</td>
      <td>10.0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3992</th>
      <td>Sardaarji</td>
      <td>9.5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2386</th>
      <td>One Man's Hero</td>
      <td>9.3</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2970</th>
      <td>There Goes My Baby</td>
      <td>8.5</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1881</th>
      <td>The Shawshank Redemption</td>
      <td>8.5</td>
      <td>8205</td>
    </tr>
    <tr>
      <th>2796</th>
      <td>The Prisoner of Zenda</td>
      <td>8.4</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3337</th>
      <td>The Godfather</td>
      <td>8.4</td>
      <td>5893</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-12fa32e9-8f85-4069-8466-5b6a5805aeeb')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-12fa32e9-8f85-4069-8466-5b6a5805aeeb button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-12fa32e9-8f85-4069-8466-5b6a5805aeeb');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




IMDB의 가중평점 공식을 차용하여, 평점을 매긴 횟수에 대한 Weight를 적용

![가중평점.png](data:image/png;base64,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)
> - v: 개별 영화에 평점을 투표한 횟수  
- m: 평점을 부여하기 위한 최소 투표 횟수  
- R: 개별 영화에 대한 평균 평점  
- C: 전체 영화에 대한 평균 평점


```python
C = movies_df['vote_average'].mean()
m = movies_df['vote_count'].quantile(0.6)
print('C:',round(C,3), 'm:',round(m,3))
```

    C: 6.092 m: 370.2



```python
#기존 평점을 가중 평점으로 변환하는 함수 weighted_vote_average()를 생성
percentile = 0.6
m = movies_df['vote_count'].quantile(percentile)
C = movies_df['vote_average'].mean()

def weighted_vote_average(record):
    v = record['vote_count']
    R = record['vote_average']
    
    return ( (v/(v+m)) * R ) + ( (m/(m+v)) * C )   

movies_df['weighted_vote'] = movies_df.apply(weighted_vote_average, axis=1) 

```


```python
#re-Sorting
movies_df[['title','vote_average','weighted_vote','vote_count']].sort_values('weighted_vote',
                                                                          ascending=False)[:10]

```





  <div id="df-70230c9d-06eb-4425-8c5b-281079ee63f3">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
      <th>weighted_vote</th>
      <th>vote_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1881</th>
      <td>The Shawshank Redemption</td>
      <td>8.5</td>
      <td>8.396052</td>
      <td>8205</td>
    </tr>
    <tr>
      <th>3337</th>
      <td>The Godfather</td>
      <td>8.4</td>
      <td>8.263591</td>
      <td>5893</td>
    </tr>
    <tr>
      <th>662</th>
      <td>Fight Club</td>
      <td>8.3</td>
      <td>8.216455</td>
      <td>9413</td>
    </tr>
    <tr>
      <th>3232</th>
      <td>Pulp Fiction</td>
      <td>8.3</td>
      <td>8.207102</td>
      <td>8428</td>
    </tr>
    <tr>
      <th>65</th>
      <td>The Dark Knight</td>
      <td>8.2</td>
      <td>8.136930</td>
      <td>12002</td>
    </tr>
    <tr>
      <th>1818</th>
      <td>Schindler's List</td>
      <td>8.3</td>
      <td>8.126069</td>
      <td>4329</td>
    </tr>
    <tr>
      <th>3865</th>
      <td>Whiplash</td>
      <td>8.3</td>
      <td>8.123248</td>
      <td>4254</td>
    </tr>
    <tr>
      <th>809</th>
      <td>Forrest Gump</td>
      <td>8.2</td>
      <td>8.105954</td>
      <td>7927</td>
    </tr>
    <tr>
      <th>2294</th>
      <td>Spirited Away</td>
      <td>8.3</td>
      <td>8.105867</td>
      <td>3840</td>
    </tr>
    <tr>
      <th>2731</th>
      <td>The Godfather: Part II</td>
      <td>8.3</td>
      <td>8.079586</td>
      <td>3338</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-70230c9d-06eb-4425-8c5b-281079ee63f3')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-70230c9d-06eb-4425-8c5b-281079ee63f3 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-70230c9d-06eb-4425-8c5b-281079ee63f3');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>





```python
def find_sim_movie(df, sorted_ind, title_name, top_n=10):
    title_movie = df[df['title'] == title_name]
    title_index = title_movie.index.values
    
    # top_n의 2배에 해당하는 쟝르 유사성이 높은 index 추출 
    similar_indexes = sorted_ind[title_index, :(top_n*2)]
    similar_indexes = similar_indexes.reshape(-1)
    # 기준 영화 index는 제외
    similar_indexes = similar_indexes[similar_indexes != title_index]
    
    # top_n의 2배에 해당하는 후보군에서 weighted_vote 높은 순으로 top_n 만큼 추출
    # 가중평점에 해당하는 수를 바탕으로 top_n 추출 
    return df.iloc[similar_indexes].sort_values('weighted_vote', ascending=False)[:top_n]

similar_movies = find_sim_movie(movies_df, genre_sim_sorted_ind, 'Avatar',10)
similar_movies[['title', 'vote_average', 'weighted_vote']]

```





  <div id="df-83a6ef51-309e-4eb3-a93a-2d01344647d2">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>title</th>
      <th>vote_average</th>
      <th>weighted_vote</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>46</th>
      <td>X-Men: Days of Future Past</td>
      <td>7.5</td>
      <td>7.418594</td>
    </tr>
    <tr>
      <th>813</th>
      <td>Superman</td>
      <td>6.9</td>
      <td>6.685190</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Man of Steel</td>
      <td>6.5</td>
      <td>6.477564</td>
    </tr>
    <tr>
      <th>420</th>
      <td>Hellboy II: The Golden Army</td>
      <td>6.5</td>
      <td>6.420421</td>
    </tr>
    <tr>
      <th>870</th>
      <td>Superman II</td>
      <td>6.5</td>
      <td>6.348901</td>
    </tr>
    <tr>
      <th>232</th>
      <td>The Wolverine</td>
      <td>6.3</td>
      <td>6.282606</td>
    </tr>
    <tr>
      <th>3208</th>
      <td>Star Wars: Clone Wars: Volume 1</td>
      <td>8.0</td>
      <td>6.221858</td>
    </tr>
    <tr>
      <th>1191</th>
      <td>Small Soldiers</td>
      <td>6.2</td>
      <td>6.154700</td>
    </tr>
    <tr>
      <th>1932</th>
      <td>Sheena</td>
      <td>5.0</td>
      <td>6.030907</td>
    </tr>
    <tr>
      <th>3494</th>
      <td>Beastmaster 2: Through the Portal of Time</td>
      <td>4.6</td>
      <td>6.026658</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-83a6ef51-309e-4eb3-a93a-2d01344647d2')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">

  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>

  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-83a6ef51-309e-4eb3-a93a-2d01344647d2 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-83a6ef51-309e-4eb3-a93a-2d01344647d2');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>




##Summary

본 코드에서는 사실 장르나 제목과 같이 Single Column을 바탕으로 Rec sys를 구성하다보니 다각적으로 취향을 반영하기에는 어느 정도 어려움이 존재함은 사실입니다.

하지만 다양한 Column을 활용하여 함수를 조금 더 구체적으로 짠다면, 훨씬 더 다채로운 추천 시스템이 될 수 있을 것 같네요. 

지금까지 Content-based Filtering 소개였습니다 !

